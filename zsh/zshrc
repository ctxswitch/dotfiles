
mkdir -p $HOME/bin

KUBECTL_BIN=$(which kubectl)

export EDITOR=hx
export GIT_EDITOR=hx
export GPG_TTY=$(tty)

export PATH="$HOME/bin:$PATH"
export PATH=/usr/local/go/bin:/usr/local/kubebuilder/bin:$PATH
export PATH=/usr/local/opt/llvm/bin:$PATH
export PATH=$PATH:/usr/local/kubebuilder/bin
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
export PATH="/opt/homebrew/opt/go@1.24/bin:$PATH"

HOMEBREW_PATH=$([[ "$(uname -s)" == "Darwin" ]] && echo "/opt/homebrew" || echo "/home/linuxbrew/.linuxbrew")
[ -d $HOMEBREW_PATH ] && eval "$($HOMEBREW_PATH/bin/brew shellenv)"

# Add cargo to the path if we have rust installed.
[ -d $HOME/.cargo/bin ] && export PATH="$HOME/.cargo/bin:$PATH"
# Allow local overrides.
[ -f ${HOME}/.zshrc.local ] && . ${HOME}/.zshrc.local

# Source Prezto.
[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ] && . "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
# Add completion for kubectl
[ -f ${KUBECTL_BIN} ] && . <(${KUBECTL_BIN} completion zsh)


export FZF_DEFAULT_COMMAND='fd --type f --strip-cwd-prefix --exclude .git --exclude vendor'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
[ -f ~/.fzf.zsh ] && . ~/.fzf.zsh

# Helper functions
function cds() {
	S=$(FZF_DEFAULT_COMMAND="fd . --type d --max-depth 3 --exclude .git --exclude vendor --exclude node_modules ~/src" fzf)
	cd ${S}
}

function cdt() {
	S=$(FZF_DEFAULT_COMMAND="fd . --type d --max-depth 3 --exclude .git --exclude vendor --exclude node_modules ~/src" fzf)
	cd ${S}
	N=$(basename $S)
	tmux neww -n $N
}

function hxs() {
	S=$(FZF_DEFAULT_COMMAND="fd . --type d --max-depth 3 --exclude .git --exclude vendor --exclude node_modules ~/src" fzf)
	cd ${S}
	hx .
}

function hxt() {
	S=$(FZF_DEFAULT_COMMAND="fd . --type d --max-depth 3 --exclude .git --exclude vendor --exclude node_modules ~/src" fzf)
	cd ${S}
	N=$(basename $S)
	tmux neww -n $N 'exec hx .'
	tmux split-window -v -p 20
}

function new() {
	[ $TERM_PROGRAM != "tmux" ] && tmux has-session -t root && tmux attach -t root
	tmux neww
}

alias vim=hx
alias k=kubectl
alias ks="echo $(kubectl ctx -c): $(kubectl ns -c)"

# Create a new tmux root session if one doesn't exist.
tmux has-session -t root 2>/dev/null || tmux new-session -s root -d

# pyenv setup
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"
